<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Cover Page Summary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body { 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        
        /* Static Field Styling */
        .editable-field {
            border-radius: 4px;
            padding: 2px 4px;
            margin: -2px -4px;
            background: transparent;
            min-height: 1.5rem; /* Ensures empty fields show up */
            display: flex;
            align-items: center;
        }
        .text-right .editable-field {
            justify-content: flex-end;
        }
        
        /* Sidebar Scrollbar */
        .sidebar-scroll::-webkit-scrollbar { width: 6px; }
        .sidebar-scroll::-webkit-scrollbar-track { background: transparent; }
        .sidebar-scroll::-webkit-scrollbar-thumb { background-color: #d1d5db; border-radius: 3px; }
        .sidebar-scroll::-webkit-scrollbar-thumb:hover { background-color: #9ca3af; }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* Hide Mirrors on Screen */
        .print-only-value {
            display: none;
        }

        /* SHEET STYLES */
        .sheet {
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            padding: 0.4in;
            min-height: 11in;
            width: 8.5in;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Print Styles */
        @media print {
            @page { margin: 0; size: letter portrait; }
            body { background: white; }
            aside.sidebar { display: none !important; }
            .sheet { box-shadow: none; margin: 0; width: 100%; height: 11in; page-break-after: always; }
        }
    </style>
</head>
<body class="text-sm text-gray-900">

    <!-- LEFT SIDEBAR: UPLOAD ZONE (Visual Only) -->
    <aside class="sidebar w-80 bg-white border-r border-gray-200 flex flex-col shadow-xl z-20 h-full">
        <!-- Header -->
        <div class="p-5 bg-white border-b border-gray-100 shadow-sm z-10 shrink-0">
            <h2 class="font-bold text-gray-800 text-lg flex items-center gap-2">
                <div class="bg-indigo-600 text-white p-1 rounded">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                Policy Dashboard
            </h2>
            <div class="flex items-center justify-between mt-1">
                <p class="text-xs text-gray-400 pl-1">Document Generator</p>
                <a href="Auto dashboard.html" class="text-xs font-semibold text-indigo-600 hover:text-indigo-700 border border-indigo-200 hover:border-indigo-300 px-2 py-1 rounded">Back to Auto</a>
            </div>
        </div>

        <!-- Content: Upload Area -->
        <div class="flex-1 p-6 flex flex-col gap-6 bg-gray-50 sidebar-scroll">
            <input type="file" id="upload-file" accept=".pdf,.json" class="hidden">
            <div id="upload-zone" class="bg-white p-6 rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-center h-64 cursor-pointer hover:border-indigo-400 hover:bg-indigo-50 transition-all" data-drag-over="false">
                <div class="h-12 w-12 bg-indigo-50 text-indigo-500 rounded-full flex items-center justify-center mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                </div>
                <h3 class="font-bold text-gray-700 mb-1">Upload Quote</h3>
                <p class="text-xs text-gray-400 mb-4">Drag & drop PDF or JSON here</p>
                <button id="browse-btn" class="bg-white border border-gray-300 text-gray-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-gray-50">Browse Files</button>
            </div>
            
            <!-- Upload Status -->
            <div id="upload-status" class="hidden p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-2">
                    <div id="status-icon" class="h-5 w-5"></div>
                    <span id="status-text" class="text-sm font-semibold"></span>
                </div>
                <div id="status-details" class="text-xs text-gray-600"></div>
            </div>

            <div class="bg-blue-50 border border-blue-100 p-4 rounded-xl">
                <h4 class="text-xs font-bold text-blue-800 mb-2 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    System Status
                </h4>
                <p class="text-[10px] text-blue-600 leading-relaxed">
                    Ready to process. Upload a quote to automatically populate the cover summary on the right.
                </p>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="main-content flex-1 overflow-y-auto p-8 flex flex-col items-center" id="pages-container">
        <!-- JS WILL POPULATE SHEETS HERE -->
    </main>

    <!-- HIDDEN COMPONENT STAGING AREA -->
    <div id="staging-area" class="hidden">
        
        <!-- HEADER -->
        <div id="comp-header">
            <div class="border-b-2 border-black pb-4 mb-6">
                <div class="flex flex-col md:flex-row justify-between gap-6">
                    <div class="w-full md:w-1/2">
                        <h2 class="font-bold text-gray-700 uppercase text-[10px] tracking-wide mb-1">Broker Name, Email, Tel & Branch:</h2>
                        <input type="text" class="text-base font-bold uppercase w-full outline-none editable-field text-black" value="Eldho George" readonly>
                        <input type="text" class="w-full outline-none editable-field text-black" value="Eldho.george@kmibrokers.com" readonly>
                        <input type="text" class="w-full outline-none editable-field text-black" value="4374228353 - InsLyf Mississauga" readonly>
                    </div>
                    <div class="w-full md:w-1/2 grid grid-cols-2 gap-x-4 gap-y-2 text-right md:text-left">
                        <div><span class="block text-gray-500 text-[10px] uppercase tracking-wide">Policy/Binder#</span><input type="text" data-field="policy_number" class="font-bold text-base w-full text-right md:text-left outline-none bg-transparent placeholder-gray-400 editable-field text-black" value="" readonly></div>
                        <div><span class="block text-gray-500 text-[10px] uppercase tracking-wide">Effective Date</span><input type="text" data-field="effective_date" class="font-bold w-full text-right md:text-left outline-none bg-transparent editable-field text-black" value="" readonly></div>
                        <div><span class="block text-gray-500 text-[10px] uppercase tracking-wide">Insurance Company</span>
                            <div data-field="insurance_company" class="font-bold w-full text-right md:text-left outline-none bg-transparent editable-field text-black"></div>
                        </div>
                        <div><span class="block text-gray-500 text-[10px] uppercase tracking-wide">Policy Holder</span><input type="text" data-field="policy_holder" class="font-bold w-full text-right md:text-left outline-none bg-transparent placeholder-gray-400 editable-field text-black" value="" readonly></div>
                    </div>
                </div>
            </div>
            <div class="text-center mb-6">
                <h1 class="text-xl font-bold uppercase tracking-wide border-b-4 border-double border-gray-400 inline-block pb-1 text-black">Auto Cover Page Summary</h1>
            </div>
        </div>

        <!-- TERMS PART 1 (Accident Forgiveness + Liability) -->
        <div id="comp-terms-1" class="pt-6 border-t-2 border-black mt-2">
            <div class="grid grid-cols-2 gap-8">
                <!-- Endorsements Part 1 -->
                <div>
                    <h3 class="font-bold border-b-2 border-gray-800 mb-3 text-sm uppercase text-black pb-1">Endorsements</h3>
                    <div class="space-y-4 text-xs leading-relaxed text-justify text-gray-700">
                        <div>
                            <h4 class="font-bold underline mb-1 text-black">Accident Forgiveness (OPCF 39)</h4>
                            <p>Accident Forgiveness is indeed a valuable feature in auto insurance policies. It‚Äôs also commonly known as Accident Waiver. Here‚Äôs what it typically entails:</p>
                            <ul class="list-disc pl-4 mt-1 space-y-1">
                                <li><strong>First At-Fault Accident:</strong> If you‚Äôre at fault in an accident, this waiver allows you to maintain your current premium rate without an increase.</li>
                                <li><strong>Premium Protection:</strong> It protects your premium from rising due to your first at-fault accident.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Coverages Part 1 -->
                <div>
                    <h3 class="font-bold border-b-2 border-gray-800 mb-3 text-sm uppercase text-black pb-1">Coverages Explained</h3>
                    <div class="space-y-4 text-xs leading-relaxed text-justify text-gray-700">
                         <div>
                            <h4 class="font-bold underline mb-1 text-black">LIABILITY COVERAGE:</h4>
                            <p>Liability coverage is indeed an essential part of insurance policies. It‚Äôs designed to offer protection against claims resulting from injuries and damage to people and/or property.</p>
                            <ul class="list-disc pl-4 mt-1 space-y-1">
                                <li><strong>Legal Fees:</strong> Covers the cost of legal defense if you are sued.</li>
                                <li><strong>Settlements:</strong> Pays for the settlement or judgment if you are found legally responsible for someone elses injury or property damage.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TERMS PART 2 (The Rest) -->
        <div id="comp-terms-2" class="pt-2">
             <div class="grid grid-cols-2 gap-8">
                <!-- Endorsements Part 2 -->
                <div class="space-y-4 text-xs leading-relaxed text-justify text-gray-700">
                    <div>
                        <h4 class="font-bold underline mb-1 text-black">LOSS OF USE (OPCF 20)</h4>
                        <p>Coverage is an optional endorsement that can be added to your auto insurance policy. It provides the following benefits:</p>
                        <ul class="list-disc pl-4 mt-1 space-y-1">
                            <li><strong>Substitute Transportation:</strong> It covers the costs for alternative transportation methods if your vehicle is unavailable due to a covered claim.</li>
                            <li><strong>Rental Vehicle:</strong> If you need to rent a car, this coverage will pay for it.</li>
                            <li><strong>Public Transportation:</strong> Costs for public transit, such as buses or trains, are also covered.</li>
                        </ul>
                    </div>
                        <div>
                        <h4 class="font-bold underline mb-1 text-black">NON-OWNED AUTOMOBILE (OPCF 27)</h4>
                        <p>An optional coverage that provides a transfer of coverage on your current automobile policy with a specified limit along with the applicable deductible to a rental vehicle.</p>
                    </div>
                    <div>
                        <h4 class="font-bold underline mb-1 text-black">Waiver of Depreciation (OPCF 43)</h4>
                        <p>Is an optional endorsement for auto insurance policies that can be quite beneficial for owners of new vehicles.</p>
                    </div>
                </div>
                <!-- Coverages Part 2 -->
                <div class="space-y-4 text-xs leading-relaxed text-justify text-gray-700">
                    <div>
                        <h4 class="font-bold underline mb-1 text-black">COLLISION COVERAGE:</h4>
                        <p>Collision coverage is an optional auto insurance coverage that helps pay to repair or replace your car if it‚Äôs damaged in an accident with another vehicle or object, such as a fence or a tree, when you‚Äôre at fault.</p>
                    </div>
                    <div>
                        <h4 class="font-bold underline mb-1 text-black">COMPREHENSIVE COVERAGE:</h4>
                        <p>Comprehensive Coverage is an optional auto insurance coverage that helps protect your vehicle against a variety of risks that are not related to collisions.</p>
                        <ul class="list-disc pl-4 mt-1 grid grid-cols-2">
                            <li>Vandalism</li><li>Hail</li><li>Falling Objects</li><li>Fire</li><li>Theft</li><li>Lightning</li><li>Windstorms</li><li>Animals</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold underline mb-1 text-black">ALL PERILS:</h4>
                        <p>All Perils Coverage is the most encompassing form of physical damage insurance available for vehicles. It merges the protections offered by both Collision Coverage and Comprehensive Coverage.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- INITIALS BLOCK -->
        <div id="comp-initials">
            <div class="flex justify-end mt-auto pt-6">
                <div class="border border-black px-4 py-2 flex items-center gap-2">
                    <span class="font-bold text-xs uppercase text-black">Initial(s):</span>
                    <input type="text" class="w-16 border-b border-black outline-none text-center bg-transparent editable-field text-black" readonly>
                </div>
            </div>
        </div>

        <!-- SIGNATURES BLOCK -->
        <div id="comp-signatures" class="border-t-2 border-black pt-6 mt-4">
            <p class="text-justify text-xs italic mb-8 leading-relaxed text-gray-700">
                I understand that my selections for these coverage's will affect the potential amount I can receive toward settlement should I be injured in an automobile accident. I warrant that the broker has fully explained the coverage and options outlined above and request the broker places automobile coverage on my behalf with the coverage limits and options as selected above. I understand that by not selecting any of the above coverages, my policy will include only the standard accident benefits.
            </p>
            <div class="grid grid-cols-1 gap-6">
                <div class="grid grid-cols-3 gap-8 items-end">
                    <div><input type="text" class="w-full border-b border-black outline-none bg-transparent font-serif editable-field text-black" placeholder="Enter Name" readonly><p class="text-[10px] uppercase font-bold mt-1 text-gray-500">Policy Holder (Name)</p></div>
                    <div><div class="w-full border-b border-black h-6"></div><p class="text-[10px] uppercase font-bold mt-1 text-gray-500">Signatures</p></div>
                    <div><input type="text" class="w-full border-b border-black outline-none bg-transparent font-serif text-xs editable-field text-black" readonly><p class="text-[10px] uppercase font-bold mt-1 text-gray-500">Date</p></div>
                </div>
                <div class="grid grid-cols-3 gap-8 items-end">
                    <div><input type="text" class="w-full border-b border-black outline-none bg-transparent font-serif editable-field text-black" placeholder="Enter Name" readonly><p class="text-[10px] uppercase font-bold mt-1 text-gray-500">Policy Holder (Name)</p></div>
                    <div><div class="w-full border-b border-black h-6"></div><p class="text-[10px] uppercase font-bold mt-1 text-gray-500">Signatures</p></div>
                    <div><input type="text" class="w-full border-b border-black outline-none bg-transparent font-serif text-xs editable-field text-black" readonly><p class="text-[10px] uppercase font-bold mt-1 text-gray-500">Date</p></div>
                </div>
            </div>
        </div>

        <!-- VEHICLE STORAGE -->
        <div id="vehicle-storage">
             <!-- Vehicle 1 (Full Coverage) -->
            <div class="vehicle-card border-2 border-black print-border break-inside-avoid shadow-sm mb-6" id="vehicle-1">
                <div class="bg-gray-800 text-white py-1.5 px-3 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-sm uppercase">Vehicle 1</span>
                        <span class="text-xs text-gray-300 font-medium">Full Coverage</span>
                    </div>
                    <input type="text" data-field="vehicle_1_year_make_model" class="bg-transparent text-white font-bold uppercase text-right w-1/2 outline-none placeholder-gray-400 editable-field" value="" readonly>
                </div>
                <div class="flex flex-col md:flex-row border-t border-black">
                    <div class="w-full md:w-1/3 bg-slate-50 p-3 border-b md:border-b-0 md:border-r border-black">
                        <h4 class="text-xs font-bold text-gray-900 uppercase mb-3 border-b-2 border-gray-300 pb-1">Core Coverage</h4>
                        <div class="space-y-2">
                            <div>
                                <label class="text-[9px] font-bold text-gray-500 uppercase block mb-0.5">Bodily Injury & Property Damage</label>
                                <div data-field="vehicle_1_bi_pd" class="w-full font-bold bg-transparent outline-none border-b border-dashed border-gray-400 text-sm editable-field text-black"></div>
                            </div>
                            <div><label class="text-[9px] font-bold text-gray-500 uppercase block mb-0.5">Direct Comp. Deductible</label><div data-field="vehicle_1_direct_comp_deductible" class="font-bold w-full outline-none text-sm bg-transparent border-b border-dashed border-gray-400 editable-field text-black"></div></div>
                        </div>
                    </div>
                    <div class="w-full md:w-2/3 bg-white p-3">
                        <h4 class="text-xs font-bold text-gray-900 uppercase mb-3 border-b-2 border-gray-300 pb-1">Accident Benefits & Additional</h4>
                        <div class="grid grid-cols-2 gap-x-6 gap-y-2">
                            <div class="col-span-2 bg-blue-50 p-2.5 rounded -mx-2 mb-1 group-pd border border-blue-100">
                                <label class="text-[9px] font-bold text-blue-700 uppercase block mb-1">Physical Damage</label>
                                <div class="mode-all-perils flex justify-between items-center"><span class="text-[9px] font-bold text-gray-600 uppercase">All Perils</span><div class="flex items-center gap-1"><span class="text-[9px] text-gray-400 uppercase">Deductible:</span><span data-field="vehicle_1_all_perils_deductible" class="font-bold text-right w-24 outline-none text-blue-900 bg-transparent border-b border-blue-200 editable-field text-sm"></span></div></div>
                            </div>
                            <div class="cov-uninsured"><label class="text-[9px] font-bold text-gray-500 uppercase block">Uninsured Automobile</label><div data-field="vehicle_1_uninsured_auto" class="font-bold w-full outline-none border-b border-gray-100 editable-field text-black text-sm">Included</div></div>
                            <div class="cov-44"><label class="text-[9px] font-bold text-gray-500 uppercase block">#44 Family Protection</label><div data-field="vehicle_1_family_protection" class="font-bold w-full outline-none border-b border-gray-100 editable-field text-black text-sm"></div></div>
                            <div class="cov-20 group-opcf20"><label class="text-[9px] font-bold text-gray-500 uppercase block">#20 Loss of Use</label><div data-field="vehicle_1_loss_of_use" class="font-bold w-full outline-none border-b border-gray-100 bg-transparent editable-field text-black text-sm"></div></div>
                            <div class="cov-27 group-opcf27"><label class="text-[9px] font-bold text-gray-500 uppercase block">#27 Non-Owned Auto</label><div data-field="vehicle_1_non_owned_auto" class="font-bold w-full outline-none border-b border-gray-100 bg-transparent editable-field text-black text-sm"></div></div>
                            <div class="checkbox-container col-span-2 pt-2 mt-2 border-t border-gray-100 flex flex-wrap gap-4 text-xs font-bold text-gray-700">
                                <label class="flex items-center gap-1 select-none">‚òê Acc. Forgiveness</label>
                                <label class="flex items-center gap-1 select-none">‚òê OPCF 43</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vehicle 2 (Liability Only) -->
            <div class="vehicle-card border-2 border-black print-border break-inside-avoid shadow-sm mb-6" id="vehicle-liability">
                <div class="bg-gray-800 text-white py-1.5 px-3 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-sm uppercase">Vehicle 2</span>
                        <span class="text-xs font-bold border border-white px-2 rounded">Liability Only</span>
                    </div>
                    <input type="text" data-field="vehicle_2_year_make_model" class="bg-transparent text-white font-bold uppercase text-right w-1/2 outline-none placeholder-gray-400 editable-field" value="" readonly>
                </div>
                <div class="flex flex-col md:flex-row border-t border-black">
                    <div class="w-full md:w-1/3 bg-slate-50 p-3 border-b md:border-b-0 md:border-r border-black">
                        <h4 class="text-xs font-bold text-gray-900 uppercase mb-3 border-b-2 border-gray-300 pb-1">Core Coverage</h4>
                        <div class="space-y-2">
                            <div>
                                <label class="text-[9px] font-bold text-gray-500 uppercase block mb-0.5">Bodily Injury & Property Damage</label>
                                <div data-field="vehicle_2_bi_pd" class="w-full font-bold bg-transparent outline-none border-b border-dashed border-gray-400 text-sm editable-field text-black"></div>
                            </div>
                            <div><label class="text-[9px] font-bold text-gray-500 uppercase block mb-0.5">Direct Comp. Deductible</label><div data-field="vehicle_2_direct_comp_deductible" class="font-bold w-full outline-none text-sm bg-transparent border-b border-dashed border-gray-400 editable-field text-black"></div></div>
                        </div>
                    </div>
                    <div class="w-full md:w-2/3 bg-white p-3">
                        <h4 class="text-xs font-bold text-gray-900 uppercase mb-3 border-b-2 border-gray-300 pb-1">Accident Benefits & Additional</h4>
                        <div class="grid grid-cols-2 gap-x-6 gap-y-2">
                            
                            <div class="cov-uninsured"><label class="text-[9px] font-bold text-gray-500 uppercase block">Uninsured Automobile</label><div data-field="vehicle_2_uninsured_auto" class="font-bold w-full outline-none border-b border-gray-100 editable-field text-black text-sm">Included</div></div>
                            <div class="cov-44"><label class="text-[9px] font-bold text-gray-500 uppercase block">#44 Family Protection</label><div data-field="vehicle_2_family_protection" class="font-bold w-full outline-none border-b border-gray-100 editable-field text-black text-sm"></div></div>
                            
                            <!-- Filler for missing coverage space -->
                             <div class="col-span-2 pt-4 text-xs text-gray-400 italic text-center border-t border-gray-100 mt-2">
                                Physical Damage & Optional Endorsements Not Included
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- PAGINATION LOGIC (Visual Layout Only) ---
        // Keeps the content organized in 8.5x11 sheets
        
        document.addEventListener('DOMContentLoaded', function() {
            paginate();
            setupFileUpload();
        });

        function paginate() {
            const pagesContainer = document.getElementById('pages-container');
            const stagingArea = document.getElementById('staging-area');
            const vehicleStorage = document.getElementById('vehicle-storage');

            // 1. Clear Pages
            pagesContainer.innerHTML = '';
            
            // 2. Clone References
            const header = document.getElementById('comp-header').cloneNode(true);
            const terms1 = document.getElementById('comp-terms-1').cloneNode(true);
            const terms2 = document.getElementById('comp-terms-2').cloneNode(true);
            const signatures = document.getElementById('comp-signatures').cloneNode(true);
            const initials = document.getElementById('comp-initials').cloneNode(true);
            const vehicle1 = document.getElementById('vehicle-1').cloneNode(true);
            const vehicle2 = document.getElementById('vehicle-liability').cloneNode(true); // Clone liability vehicle

            // 3. Construct Page 1
            let page1 = createSheet();
            pagesContainer.appendChild(page1);

            page1.appendChild(header);
            page1.appendChild(vehicle1); // Show Full Coverage
            page1.appendChild(vehicle2); // Show Liability Only
            page1.appendChild(terms1);  // Show Terms Part 1
            
            // Footer Initials for Page 1
            const p1Initials = initials.cloneNode(true);
            p1Initials.style.marginTop = 'auto';
            page1.appendChild(p1Initials);

            // 4. Construct Page 2
            let page2 = createSheet();
            pagesContainer.appendChild(page2);
            
            page2.appendChild(terms2); // Terms Part 2
            page2.appendChild(signatures); // Signatures
            
            // Footer Initials for Page 2
            const p2Initials = initials.cloneNode(true);
            p2Initials.style.marginTop = 'auto';
            page2.appendChild(p2Initials);
        }

        function createSheet() {
            const div = document.createElement('div');
            div.className = 'sheet';
            return div;
        }

        // ========== FILE UPLOAD LOGIC ==========
        function setupFileUpload() {
            const uploadZone = document.getElementById('upload-zone');
            const fileInput = document.getElementById('upload-file');
            const browseBtn = document.getElementById('browse-btn');
            const uploadStatus = document.getElementById('upload-status');

            // Browse button click
            browseBtn.addEventListener('click', () => {
                fileInput.click();
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0], uploadStatus);
                }
            });

            // Drag and drop
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadZone.setAttribute('data-drag-over', 'true');
                uploadZone.classList.add('border-indigo-400', 'bg-indigo-50');
            });

            uploadZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadZone.setAttribute('data-drag-over', 'false');
                uploadZone.classList.remove('border-indigo-400', 'bg-indigo-50');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadZone.setAttribute('data-drag-over', 'false');
                uploadZone.classList.remove('border-indigo-400', 'bg-indigo-50');

                if (e.dataTransfer.files.length > 0) {
                    handleFileUpload(e.dataTransfer.files[0], uploadStatus);
                }
            });
        }

        async function handleFileUpload(file, uploadStatus) {
            const statusIcon = document.getElementById('status-icon');
            const statusText = document.getElementById('status-text');
            const statusDetails = document.getElementById('status-details');

            // Check file type
            if (!file.name.toLowerCase().endsWith('.pdf') && !file.name.toLowerCase().endsWith('.json')) {
                showStatus('error', 'Invalid file type', 'Please upload a PDF or JSON file', uploadStatus, statusIcon, statusText, statusDetails);
                return;
            }

            // Show uploading status
            showStatus('loading', 'Uploading...', `Processing ${file.name}`, uploadStatus, statusIcon, statusText, statusDetails);

            try {
                const formData = new FormData();
                formData.append('file', file);

                // Send to backend
                const response = await fetch('/api/parse-quote', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showStatus('success', 'Quote parsed successfully!', `Extracted data from ${file.name}`, uploadStatus, statusIcon, statusText, statusDetails);
                    
                    // Populate form fields with extracted data
                    populateFormFields(result.data);
                    
                    // Re-paginate to show updated content
                    paginate();
                } else {
                    showStatus('error', 'Parsing failed', result.error || 'Could not parse file', uploadStatus, statusIcon, statusText, statusDetails);
                }
            } catch (error) {
                showStatus('error', 'Upload error', error.message, uploadStatus, statusIcon, statusText, statusDetails);
            }
        }

        function showStatus(type, title, message, statusEl, iconEl, textEl, detailsEl) {
            statusEl.classList.remove('hidden');
            detailsEl.textContent = message;
            textEl.textContent = title;

            // Update icon and styling
            if (type === 'loading') {
                iconEl.innerHTML = '<svg class="animate-spin h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
                statusEl.className = 'p-4 rounded-xl bg-blue-50 border border-blue-100';
            } else if (type === 'success') {
                iconEl.innerHTML = '<svg class="h-5 w-5 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                statusEl.className = 'p-4 rounded-xl bg-green-50 border border-green-100';
            } else if (type === 'error') {
                iconEl.innerHTML = '<svg class="h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>';
                statusEl.className = 'p-4 rounded-xl bg-red-50 border border-red-100';
            }
        }

        function populateFormFields(data) {
            console.log('üìù Populating form with data:', data);
            const stagingArea = document.getElementById('staging-area');

            const setFieldValue = (fieldName, value) => {
                if (!value && value !== 0) return;
                const nodes = stagingArea.querySelectorAll(`[data-field="${fieldName}"]`);
                nodes.forEach(node => {
                    if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') {
                        node.value = value;
                    } else {
                        node.textContent = value;
                    }
                });
            };

            const getFirstValue = (keys) => {
                for (const key of keys) {
                    if (data[key]) return data[key];
                }
                return null;
            };

            // Header fields
            setFieldValue('policy_number', getFirstValue(['policy_number', 'binder_number', 'policy_no', 'policy']));
            setFieldValue('effective_date', getFirstValue(['effective_date', 'issue_date', 'renewal_date', 'report_date']));
            setFieldValue('insurance_company', getFirstValue(['insurance_company', 'company', 'insurer']));
            setFieldValue('policy_holder', getFirstValue(['policy_holder', 'policy_holder_name', 'client_name', 'name']));

            // Vehicle information if available
            const vehicles = Array.isArray(data.vehicles) ? data.vehicles : (Array.isArray(data.policy1_vehicles) ? data.policy1_vehicles : []);
            if (vehicles[0]?.year_make_model) {
                setFieldValue('vehicle_1_year_make_model', vehicles[0].year_make_model);
            } else if (data.vehicle_year_make_model) {
                setFieldValue('vehicle_1_year_make_model', data.vehicle_year_make_model);
            }
            if (vehicles[1]?.year_make_model) {
                setFieldValue('vehicle_2_year_make_model', vehicles[1].year_make_model);
            }

            const biPdValue = getFirstValue([
                'bodily_injury_property_damage',
                'bi_pd_limit'
            ]) || (data.bodily_injury_limit || data.property_damage_limit
                ? `${data.bodily_injury_limit || '-'} / ${data.property_damage_limit || '-'}`
                : null);

            const directCompDed = getFirstValue([
                'direct_comp_deductible',
                'direct_comp_ded',
                'direct_compensation_deductible'
            ]);

            setFieldValue('vehicle_1_bi_pd', biPdValue);
            setFieldValue('vehicle_2_bi_pd', biPdValue);
            setFieldValue('vehicle_1_direct_comp_deductible', directCompDed);
            setFieldValue('vehicle_2_direct_comp_deductible', directCompDed);

            setFieldValue('vehicle_1_all_perils_deductible', getFirstValue(['all_perils_deductible']));
            setFieldValue('vehicle_1_loss_of_use', getFirstValue(['loss_of_use_limit']));
            setFieldValue('vehicle_1_family_protection', getFirstValue(['family_protection_limit']));
            setFieldValue('vehicle_1_non_owned_auto', getFirstValue(['non_owned_auto_limit']));

            setFieldValue('vehicle_2_loss_of_use', getFirstValue(['loss_of_use_limit']));
            setFieldValue('vehicle_2_family_protection', getFirstValue(['family_protection_limit']));
            setFieldValue('vehicle_2_non_owned_auto', getFirstValue(['non_owned_auto_limit']));
        }

        function populateVehicleData(vehicles) {
            const vehicle1Card = document.getElementById('vehicle-1');
            const vehicle2Card = document.getElementById('vehicle-liability');

            if (vehicles[0]) {
                const v1 = vehicles[0];
                // Vehicle year/make/model
                const v1Header = vehicle1Card?.querySelector('.bg-gray-800 input');
                if (v1Header && v1.year_make_model) {
                    v1Header.value = v1.year_make_model;
                }
                // Update vehicle coverages
                populateVehicleCoverages(vehicle1Card, v1);
            }

            if (vehicles[1]) {
                const v2 = vehicles[1];
                const v2Header = vehicle2Card?.querySelector('.bg-gray-800 input');
                if (v2Header && v2.year_make_model) {
                    v2Header.value = v2.year_make_model;
                }
                populateVehicleCoverages(vehicle2Card, v2);
            }
        }

        function populateVehicleCoverages(vehicleCard, vehicleData) {
            if (!vehicleCard) return;

            // Populate bodily injury & property damage
            const liabilityField = vehicleCard.querySelector('[class*="Bodily"]')?.parentElement?.querySelector('.editable-field');
            if (liabilityField && vehicleData.liability_limits) {
                liabilityField.textContent = vehicleData.liability_limits;
            }

            // Populate deductibles
            const deductibleField = vehicleCard.querySelector('[class*="Deductible"]')?.parentElement?.querySelector('.editable-field');
            if (deductibleField && vehicleData.deductible) {
                deductibleField.textContent = vehicleData.deductible;
            }

            // Populate other coverages
            if (vehicleData.optional_coverages) {
                vehicleData.optional_coverages.forEach(coverage => {
                    const field = vehicleCard.querySelector(`.${coverage.code.toLowerCase().replace(/\s+/g, '-')}`);
                    if (field) {
                        const editField = field.querySelector('.editable-field');
                        if (editField) {
                            editField.textContent = coverage.limit || 'Included';
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>